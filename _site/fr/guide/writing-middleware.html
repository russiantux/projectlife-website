<!DOCTYPE html>
<html lang="fr">

  <head>
    <title>Ecriture de middleware utilisable dans les applications Express</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/dropit.css">
    <link rel="stylesheet" href="/css/prism.css">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,700&amp;amp;subset=latin,latin-ext">
    <link rel="stylesheet" href="/css/fr.css">        
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script data-cfasync="false" src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script data-cfasync="false" src="/js/app.js"></script>
    <script data-cfasync="false" src="/js/retina.js"></script>
    <script data-cfasync="false" src="/js/dropit.js"></script>
    <script data-cfasync="false" src="/js/prism.js"></script>
</head>


  
  <body class="non-en-doc">
  

    <section class="page content">

      <header>
  <div id="mobile-menu">
      <div id="nav-button" class="fa fa-bars fa-2x button"></div>
  </div>
  <section id="logo"><a href="/" class="express">Express</a>
  </section>
  <div id="navbar">
      <ul id="navmenu">
          <li><a href="/fr/" id="home-menu">Accueil</a></li>
          <li>
              <ul id="getting-started-menu" class="menu">
                  <li><a href="/fr/starter/installing.html">Mise en route</a>
                      <ul>
                          <li>
                            <a href="/fr/starter/installing.html">
                              Installation
                            </a>
                          </li>
                          <li>
                            <a href="/fr/starter/hello-world.html">
                              Hello world
                            </a>
                          </li>
                          <li>
                          <a href="/fr/starter/generator.html">
                            Générateur Express
                          </a>
                          </li>
                          <li>
                            <a href="/fr/starter/basic-routing.html">
                              Routage de base
                            </a>
                          </li>
                          <li>
                            <a href="/fr/starter/static-files.html">
                              Fichiers statiques
                            </a>
                          </li>
                          <li>
                            <a href="/fr/starter/faq.html">
                              FAQ
                            </a>
                          </li>
                      </ul>
                  </li>
              </ul>
          </li>
          <li>
              <ul id="guide-menu" class="menu">
                  <li><a href="/fr/guide/routing.html" class="active">Guide</a>
                      <ul>
                          <li><a href="/fr/guide/routing.html">Routage</a>
                          </li>
                          <li><a href="/fr/guide/writing-middleware.html">Ecriture de middleware</a>
                          </li>
                          <li><a href="/fr/guide/using-middleware.html">Utilisation de middleware</a>
                          </li>
                          <li><a href="/fr/guide/using-template-engines.html">Utilisation de moteurs de modèles</a>
                          </li>
                          <li><a href="/fr/guide/error-handling.html">Traitement d'erreurs</a>
                          </li>
                          <li><a href="/fr/guide/debugging.html">Débogage</a>
                          </li>
                          <li><a href="/fr/guide/behind-proxies.html">Express derrière Proxys</a>
                          </li>
                          <li><a href="/fr/guide/migrating-4.html">Migration vers Express 4</a>
                          </li>
                          <li><a href="/fr/guide/migrating-5.html">Migration vers Express 5</a>
                          </li>
                          <li><a href="/fr/guide/database-integration.html">Intégration de bases de données</a>
                          </li>
                      </ul>
                  </li>
              </ul>
          </li>
          <li>
              <ul id="application-menu" class="menu">
                  <li><a href="/fr/4x/api.html">Référence de l'API</a>
                      <ul>
                          <li><a href="/fr/4x/api.html">4.x</a>
                          </li>
                          <li><a href="/fr/3x/api.html">3.x (obsolète)</a>
                          </li>
                          <li><a href="/fr/2x/">2.x (obsolète)</a>
                          </li>
                      </ul>
                  </li>
              </ul>
          </li>
          <li>
              <ul id="advanced-topics-menu" class="menu">
                  <li><a href="/fr/advanced/developing-template-engines.html">Rubriques avancées</a>
                      <ul>
                          <li><a href="/fr/advanced/developing-template-engines.html">Moteurs de modèles</a>
                          </li>
                          <li><a href="/fr/advanced/pm.html">Utilisation de gestionnaires de processus</a>
                          </li>
                          <li><a href="/fr/advanced/security-updates.html">Mises à jour de sécurité</a>
                          </li>
                          <li><a href="/fr/advanced/best-practice-security.html">Meilleures pratiques en termes de sécurité</a>
                          </li>
                          <li><a href="/fr/advanced/best-practice-performance.html">Meilleures pratiques en termes de performances</a>
                          </li>

                      </ul>
                  </li>
              </ul>
          </li>
          <li>
              <ul id="resources-menu" class="menu">
                  <li><a href="/fr/resources/glossary.html">Ressources</a>
                      <ul>
                          <li><a href="/fr/resources/glossary.html">Glossaire</a>
                          </li>
                          <li><a href="/fr/resources/middleware.html">Middleware</a>
                          </li>
                          <li><a href="/fr/resources/community.html">Communauté</a>
                          </li>
                          <li><a href="/fr/resources/books-blogs.html">Ouvrages et blogs</a>
                          </li>
                          <li><a href="/fr/resources/applications.html">Applications</a>
                          </li>
                      </ul>
                  </li>
              </ul>
          </li>
      </ul>
  </div><a href="http://strongloop.com/node-js/training/" title="Formation sur Node et Express à partir de StrongLoop" id="strongloop-header">Formation sur Express et Node.js à partir de StrongLoop</a>
</header>


      <div id="overlay"></div>

      
        <div id="i18n-notice-box" class="doc-box doc-warn">
          <p>Il se peut que ce document soit obsolète par rapport à la documentation en anglais. Pour connaître les mises à jour les plus récentes, reportez-vous à la <a href="/">documentation en anglais</a>.
</p>
<p>This document might be outdated relative to the documentation in English. For the latest updates, please refer to the <a href="/">documentation in English</a>.
</p>
<div id="close-i18n-notice-box" title="Close">✖</div>

        </div>
      

      <h1 id="ecriture-de-middleware-utilisable-dans-les-applications-express">Ecriture de middleware utilisable dans les applications Express</h1>

<h2>Présentation</h2>

<p>Les fonctions de <em>middleware</em> sont des fonctions qui peuvent accéder à l’<a href="/fr/4x/api.html#req">objet Request</a>  (<code class="highlighter-rouge">req</code>), l’<a href="/fr/4x/api.html#res">objet response</a> (<code class="highlighter-rouge">res</code>) et à la fonction middleware suivant dans le cycle demande-réponse de l’application. La fonction middleware suivant est couramment désignée par une variable nommée <code class="highlighter-rouge">next</code>.</p>

<p>Les fonctions middleware effectuent les tâches suivantes :</p>

<ul>
  <li>Exécuter tout type de code.</li>
  <li>Apporter des modifications aux objets de demande et de réponse.</li>
  <li>Terminer le cycle de demande-réponse.</li>
  <li>Appeler le middleware suivant dans la pile.</li>
</ul>

<p>Si la fonction middleware en cours ne termine pas le cycle de demande-réponse, elle doit appeler la fonction <code class="highlighter-rouge">next()</code> pour transmettre le contrôle à la fonction middleware suivant. Sinon, la demande restera bloquée.</p>

<p>L’exemple suivant montre les éléments d’un appel de fonction middleware:</p>

<table style="padding: 0; border: 0; width: 960px; margin-bottom: 10px;">
<tr><td style="margin: 0; padding: 0px; border: 0; width: 410px;">
<img src="/images/express-mw.png" style="margin: 0px; padding: 0px; width: 410px; height: 308px;" />
</td>
<td style="margin: 0; padding: 0 0 0 5px; border: 0; width: 550px;">
<div class="callout" id="callout1">Méthode HTTP à laquelle la fonction middleware s'applique.</div>

<div class="callout" id="callout2">Chemin (route) auquel la fonction middleware s'applique.</div>

<div class="callout" id="callout3">Fonction de middleware.</div>

<div class="callout" id="callout4">Argument de rappel à la fonction middleware, appelée "next" par convention.</div>

<div class="callout" id="callout5">Argument de <a href="../4x/api.html#res">réponse</a> HTTP à la fonction middleware, appelé "res" par convention.</div>

<div class="callout" id="callout6">Argument de <a href="../4x/api.html#req">demande</a> HTTP à la fonction middleware, appelé "req" par convention.</div>
</td></tr>
</table>

<!--
<pre>
<code class="language-javascript" translate="no">
var express = require('express');
var app = express();
app.get('/', function(req, res, next) {
	next();
})
</code>
</pre>

* <code>app.get</code>: Méthode HTTP à laquelle la fonction middleware s'applique.

* <code>'/'</code>: Chemin (route) auquel la fonction middleware s'applique.

* <code>function</code>: Fonction de middleware.

* <code>req</code>: Argument de <a href="../4x/api.html#req">demande</a> HTTP à la fonction middleware, appelé "req" par convention.

* <code>res</code>: Argument de <a href="../4x/api.html#res">réponse</a> HTTP à la fonction middleware, appelé "res" par convention.

* <code>next</code>: Argument de rappel à la fonction middleware, appelée "next" par convention.
-->

<p>Voici un exemple d’une application Express “Hello World” simple, pour laquelle vous allez définir deux fonctions middleware :</p>

<pre>
<code class="language-javascript" translate="no">
var express = require('express');
var app = express();

app.get('/', function (req, res) {
  res.send('Hello World!');
});

app.listen(3000);
</code>
</pre>

<h2>Développement</h2>

<p>Voici un exemple simple de fonction middleware appelée “myLogger”. Cette fonction imprime simplement “LOGGED” lorsqu’une demande traverse l’application. La fonction middleware est affectée à une variable nommée <code class="highlighter-rouge">myLogger</code>.</p>

<pre>
<code class="language-javascript" translate="no">
var myLogger = function (req, res, next) {
  console.log('LOGGED');
  next();
};
</code>
</pre>

<div class="doc-box doc-notice">
  <p>Notez l’appel ci-dessus de la fonction <code class="highlighter-rouge">next()</code>,  qui appelle la fonction middleware suivant dans l’application. La fonction <code class="highlighter-rouge">next()</code> ne fait pas partie du Node.js ou de l’API Express, mais c’est le troisième argument qui est transmis à la fonction middleware.  La fonction <code class="highlighter-rouge">next()</code> peut porter n’importe quel nom, mais par convention elle est toujours appelée “next”. Pour éviter toute confusion, il est préférable de respecter cette convention.</p>
</div>

<p>Pour charger la fonction middleware, appelez <code class="highlighter-rouge">app.use()</code> en spécifiant la fonction middleware.
Par exemple, le code suivant charge la fonction middleware <code class="highlighter-rouge">myLogger</code> avant la route au chemin racine (/).</p>

<pre>
<code class="language-javascript" translate="no">
var express = require('express');
var app = express();

var myLogger = function (req, res, next) {
  console.log('LOGGED');
  next();
};

app.use(myLogger);

app.get('/', function (req, res) {
  res.send('Hello World!');
});

app.listen(3000);
</code>
</pre>

<p>Chaque fois que l’application reçoit une demande, elle imprime le message “LOGGED” sur le terminal.</p>

<p>L’ordre de chargement des middleware est important : les fonctions middleware chargées en premier sont également exécutées en premier.</p>

<p>Si <code class="highlighter-rouge">myLogger</code> est chargé après la route au chemin racine, la demande ne l’atteindra jamais et l’application n’imprimera pas “LOGGED”, car le gestionnaire de route du chemin racine interrompra le cycle de demande-réponse.</p>

<p>La fonction middleware <code class="highlighter-rouge">myLogger</code> imprime simplement un message, puis traite la demande à la fonction middleware suivant dans la pile en appelant la fonction <code class="highlighter-rouge">next()</code>.</p>

<p>L’exemple suivant ajoute une propriété appelée <code class="highlighter-rouge">requestTime</code> à l’objet Request. Nous nommerons cette fonction middleware “requestTime”.</p>

<pre>
<code class="language-javascript" translate="no">
var requestTime = function (req, res, next) {
  req.requestTime = Date.now();
  next();
};
</code>
</pre>

<p>L’application utilise désormais la fonction middleware <code class="highlighter-rouge">requestTime</code>. De plus, la fonction callback de la route du chemin racine utilise la propriété que la fonction middleware ajoute à <code class="highlighter-rouge">req</code> (l’objet Request).</p>

<pre>
<code class="language-javascript" translate="no">
var express = require('express');
var app = express();

var requestTime = function (req, res, next) {
  req.requestTime = Date.now();
  next();
};

app.use(requestTime);

app.get('/', function (req, res) {
  var responseText = 'Hello World!<br />';
  responseText += '<small>Requested at: ' + req.requestTime + '</small>';
  res.send(responseText);
});

app.listen(3000);
</code>
</pre>

<p>Si vous effectuez une demande à la racine de l’application, cette dernière affiche maintenant l’horodatage de la demande dans le navigateur.</p>

<p>Puisque vous avez accès à l’objet Request, à l’objet Response, à la fonction middleware suivant dans la pile et à l’API Node.js complète, le champ des possibles avec les fonctions middleware est infini.</p>

<p>Pour plus d’informations sur les middleware Express, voir <a href="/fr/guide/using-middleware.html">Utilisation de middleware Express</a>.</p>


    </section>

    <!-- NLS_CHARSET=UTF-8 -->
<noscript>
    <iframe src="//www.googletagmanager.com/ns.html?id=GTM-5XL76H" height="0" width="0" style="display: none; visibility: hidden;"></iframe>
</noscript>
<script>
(function(w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({
        'gtm.start': new Date().getTime(),
        event: 'gtm.js'
    });
    var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != 'dataLayer' ? '&l=' + l : '';
    j.async = true;
    j.src =
        '//www.googletagmanager.com/gtm.js?id=' + i + dl;
    f.parentNode.insertBefore(j, f);
})(window, document, 'script', 'dataLayer', 'GTM-5XL76H');
</script>
<a id="top" href="#"><img src="/images/arrow.png"></a>

<footer>
    <div id="footer-content">
        <div id="github">
            <iframe src="http://ghbtns.com/github-btn.html?user=strongloop&amp;repo=express&amp;type=watch&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="110" height="20"></iframe>
        </div>
        <div id="sponsor">Le <a href="https://github.com/strongloop/express/">projet Express</a> est sponsorisé par <a href="http://strongloop.com/">StrongLoop</a>. </div>
        <div id="fork"><a href="https://github.com/strongloop/expressjs.com">Consultez le site Web GitHub</a>.
        </div>
        <div>Copyright &copy; StrongLoop, Inc., et autres contributeurs expressjs.com.</div>
    </div>
</footer>


  </body>

</html>
