<!DOCTYPE html>
<html lang="es">

  <head>
    <title>Escritura de middleware para su uso en aplicaciones Express</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/dropit.css">
    <link rel="stylesheet" href="/css/prism.css">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,700&amp;amp;subset=latin,latin-ext">
    <link rel="stylesheet" href="/css/es.css">        
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script data-cfasync="false" src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script data-cfasync="false" src="/js/app.js"></script>
    <script data-cfasync="false" src="/js/retina.js"></script>
    <script data-cfasync="false" src="/js/dropit.js"></script>
    <script data-cfasync="false" src="/js/prism.js"></script>
</head>


  
  <body class="non-en-doc">
  

    <section class="page content">

      <header>
  <div id="mobile-menu">
      <div id="nav-button" class="fa fa-bars fa-2x button"></div>
  </div>
  <section id="logo"><a href="/" class="express">Express</a>
  </section>
  <div id="navbar">
      <ul id="navmenu">
          <li><a href="/es/" id="home-menu">Inicio</a></li>
          <li>
              <ul id="getting-started-menu" class="menu">
                  <li><a href="/es/starter/installing.html">Cómo empezar</a>
                      <ul>
                          <li>
                            <a href="/es/starter/installing.html">
                              Instalación
                            </a>
                          </li>
                          <li>
                            <a href="/es/starter/hello-world.html">
                              Hello world
                            </a>
                          </li>
                          <li>
                          <a href="/es/starter/generator.html">
                            Generador de Express
                          </a>
                          </li>
                          <li>
                            <a href="/es/starter/basic-routing.html">
                              Direccionamiento básico
                            </a>
                          </li>
                          <li>
                            <a href="/es/starter/static-files.html">
                              Archivos estáticos
                            </a>
                          </li>
                          <li>
                            <a href="/es/starter/faq.html">
                              Preguntas más frecuentes
                            </a>
                          </li>
                      </ul>
                  </li>
              </ul>
          </li>
          <li>
              <ul id="guide-menu" class="menu">
                  <li><a href="/es/guide/routing.html" class="active">Guía</a>
                      <ul>
                          <li><a href="/es/guide/routing.html">Direccionamiento</a>
                          </li>
                          <li><a href="/es/guide/writing-middleware.html">Escritura de middleware</a>
                          </li>
                          <li><a href="/es/guide/using-middleware.html">Utilización del middleware</a>
                          </li>
                          <li><a href="/es/guide/using-template-engines.html">Utilización de motores de plantilla</a>
                          </li>
                          <li><a href="/es/guide/error-handling.html">Manejo de errores</a>
                          </li>
                          <li><a href="/es/guide/debugging.html">Depuración</a>
                          </li>
                          <li><a href="/es/guide/behind-proxies.html">Express detrás de proxies</a>
                          </li>
                          <li><a href="/es/guide/migrating-4.html">Migración a Express 4</a>
                          </li>
                          <li><a href="/es/guide/migrating-5.html">Migración a Express 5</a>
                          </li>
                          <li><a href="/es/guide/database-integration.html">Integración de la base de datos</a>
                          </li>
                      </ul>
                  </li>
              </ul>
          </li>
          <li>
              <ul id="application-menu" class="menu">
                  <li><a href="/es/4x/api.html">Referencia de API</a>
                      <ul>
                          <li><a href="/es/4x/api.html">4.x</a>
                          </li>
                          <li><a href="/es/3x/api.html">3.x (en desuso)</a>
                          </li>
                          <li><a href="/es/2x/">2.x (en desuso)</a>
                          </li>
                      </ul>
                  </li>
              </ul>
          </li>
          <li>
              <ul id="advanced-topics-menu" class="menu">
                  <li><a href="/es/advanced/developing-template-engines.html">Temas avanzados</a>
                      <ul>
                          <li><a href="/es/advanced/developing-template-engines.html">Motores de plantilla</a>
                          </li>
                          <li><a href="/es/advanced/pm.html">Utilización de gestores de procesos</a>
                          </li>
                          <li><a href="/es/advanced/security-updates.html">Actualizaciones de seguridad</a>
                          </li>
                          <li><a href="/es/advanced/best-practice-security.html">Mejores prácticas de seguridad</a>
                          </li>
                          <li><a href="/es/advanced/best-practice-performance.html">Mejores prácticas de rendimiento</a>
                          </li>

                      </ul>
                  </li>
              </ul>
          </li>
          <li>
              <ul id="resources-menu" class="menu">
                  <li><a href="/es/resources/glossary.html">Recursos</a>
                      <ul>
                          <li><a href="/es/resources/glossary.html">Glosario</a>
                          </li>
                          <li><a href="/es/resources/middleware.html">Middleware</a>
                          </li>
                          <li><a href="/es/resources/community.html">Comunidad</a>
                          </li>
                          <li><a href="/es/resources/books-blogs.html">Manuales y blogs</a>
                          </li>
                          <li><a href="/es/resources/applications.html">Aplicaciones</a>
                          </li>
                      </ul>
                  </li>
              </ul>
          </li>
      </ul>
  </div><a href="http://strongloop.com/node-js/training/" title="Formación en Node y Express de StrongLoop" id="strongloop-header">Formación en Express y Node.js de StrongLoop</a>
</header>


      <div id="overlay"></div>

      
        <div id="i18n-notice-box" class="doc-box doc-warn">
          <p>Este documento puede estar desfasado respecto a la documentación en inglés. Para ver las últimas actualizaciones, consulte la <a href="/">documentación en inglés</a>.
</p>
<p>This document might be outdated relative to the documentation in English. For the latest updates, please refer to the <a href="/">documentation in English</a>.
</p>
<div id="close-i18n-notice-box" title="Close">✖</div>

        </div>
      

      <h1 id="escritura-de-middleware-para-su-uso-en-aplicaciones-express">Escritura de middleware para su uso en aplicaciones Express</h1>

<h2>Visión general</h2>

<p>Las funciones de <em>middleware</em> son funciones que tienen acceso al <a href="/es/4x/api.html#req">objeto de solicitud</a> (<code class="highlighter-rouge">req</code>), al <a href="/es/4x/api.html#res">objeto de respuesta</a> (<code class="highlighter-rouge">res</code>) y a la siguiente función de middleware en el ciclo de solicitud/respuestas de la aplicación. La siguiente función de middleware se denota normalmente con una variable denominada <code class="highlighter-rouge">next</code>.</p>

<p>Las funciones de middleware pueden realizar las siguientes tareas:</p>

<ul>
  <li>Ejecutar cualquier código.</li>
  <li>Realizar cambios en la solicitud y los objetos de respuesta.</li>
  <li>Finalizar el ciclo de solicitud/respuestas.</li>
  <li>Invocar el siguiente middleware en la pila.</li>
</ul>

<p>Si la función de middleware actual no finaliza el ciclo de solicitud/respuestas, debe invocar <code class="highlighter-rouge">next()</code> para pasar el control a la siguiente función de middleware. De lo contrario, la solicitud quedará colgada.</p>

<p>El siguiente ejemplo muestra los elementos de una llamada a función de middleware:</p>

<table id="mw-fig">
<tr><td id="mw-fig-imgcell">
<img src="/images/express-mw.png" id="mw-fig-img" />
</td>
<td class="mw-fig-callouts">
<div class="callout" id="callout1">Método HTTP para el que se aplica la función de middleware.</div>

<div class="callout" id="callout2">Vía de acceso (ruta) para la que se aplica la función de middleware.</div>

<div class="callout" id="callout3">La función de middleware.</div>

<div class="callout" id="callout4">Argumento de devolución de llamada a la función de middleware, denominado "next" por convención.</div>

<div class="callout" id="callout5">Argumento de <a href="../4x/api.html#res">respuesta</a> HTTP a la función de middleware, denominado "res" por convención.</div>

<div class="callout" id="callout6">Argumento de <a href="../4x/api.html#req">solicitud</a> HTTP a la función de middleware, denominado "req" por convención.</div>
</td></tr>
</table>

<p>A continuación, se muestra un ejemplo de una aplicación Express simple, “Hello World”, para la que definirá dos funciones de middleware:</p>

<pre>
<code class="language-javascript" translate="no">
var express = require('express');
var app = express();

app.get('/', function (req, res) {
  res.send('Hello World!');
});

app.listen(3000);
</code>
</pre>

<h2>Desarrollo</h2>

<p>Este es un ejemplo simple de una función de middleware denominada “myLogger”. Esta función simplemente imprime “LOGGED” cuando una solicitud de la aplicación pasa por ella. La función de middleware se asigna a una variable denominada <code class="highlighter-rouge">myLogger</code>.</p>

<pre>
<code class="language-javascript" translate="no">
var myLogger = function (req, res, next) {
  console.log('LOGGED');
  next();
};
</code>
</pre>

<div class="doc-box doc-notice">
  <p>Observe la llamada anterior a <code class="highlighter-rouge">next()</code>.  La llamada a esta función invoca la siguiente función de middleware en la aplicación.
La función <code class="highlighter-rouge">next()</code> no forma parte de la API de Express o Node.js, pero es el tercer argumento que se pasa a la función de middleware.  La función <code class="highlighter-rouge">next()</code> puede tener cualquier nombre, pero por convención siempre se denomina “next”. Para evitar confusiones, utilice siempre esta convención.</p>
</div>

<p>Para cargar la función de middleware, llame a <code class="highlighter-rouge">app.use()</code>, especificando la función de middleware.
Por ejemplo, el siguiente código carga la función de middleware <code class="highlighter-rouge">myLogger</code> antes de la ruta a la vía de acceso raíz (/).</p>

<pre>
<code class="language-javascript" translate="no">
var express = require('express');
var app = express();

var myLogger = function (req, res, next) {
  console.log('LOGGED');
  next();
};

app.use(myLogger);

app.get('/', function (req, res) {
  res.send('Hello World!');
});

app.listen(3000);
</code>
</pre>

<p>Cada vez que la aplicación recibe una solicitud, imprime el mensaje “LOGGED” en el terminal.</p>

<p>El orden de carga del middleware es importante: las funciones de middleware que se cargan primero también se ejecutan primero.</p>

<p>Si <code class="highlighter-rouge">myLogger</code> se carga después de la ruta a la vía de acceso raíz, la solicitud nunca la alcanza y la aplicación no imprime “LOGGED”, ya que el manejador de rutas de la vía de acceso raíz determina el ciclo de solicitud/respuestas.</p>

<p>La función de middleware <code class="highlighter-rouge">myLogger</code> simplemente imprime un mensaje y, a continuación, pasa la solicitud a la siguiente función de middleware de la pila llamando a la función <code class="highlighter-rouge">next()</code>.</p>

<p>El siguiente ejemplo añade una propiedad denominada <code class="highlighter-rouge">requestTime</code> al objeto de solicitud. Llamaremos a esta función de middleware “requestTime”.</p>

<pre>
<code class="language-javascript" translate="no">
var requestTime = function (req, res, next) {
  req.requestTime = Date.now();
  next();
};
</code>
</pre>

<p>La aplicación ahora utiliza la función de middleware <code class="highlighter-rouge">requestTime</code>. Asimismo, la función de devolución de llamada de la ruta de vía de acceso raíz utiliza la propiedad que la función de middleware añade a <code class="highlighter-rouge">req</code> (el objeto de solicitud).</p>

<pre>
<code class="language-javascript" translate="no">
var express = require('express');
var app = express();

var requestTime = function (req, res, next) {
  req.requestTime = Date.now();
  next();
};

app.use(requestTime);

app.get('/', function (req, res) {
  var responseText = 'Hello World!<br />';
  responseText += '<small>Requested at: ' + req.requestTime + '</small>';
  res.send(responseText);
});

app.listen(3000);
</code>
</pre>

<p>Cuando realiza una solicitud a la raíz de la aplicación, la aplicación ahora muestra la indicación de fecha y hora de la solicitud en el navegador.</p>

<p>Como tiene acceso al objeto de solicitud, el objeto de respuesta, la siguiente función de middleware de la pila y toda la API de Node.js, las posibilidades con las funciones de middleware son ilimitadas.</p>

<p>Para obtener más información sobre el middleware de Express, consulte: <a href="/es/guide/using-middleware.html">Utilización del middleware de Express</a>.</p>


    </section>

    <!-- NLS_CHARSET=UTF-8 -->
<noscript>
    <iframe src="//www.googletagmanager.com/ns.html?id=GTM-5XL76H" height="0" width="0" style="display: none; visibility: hidden;"></iframe>
</noscript>
<script>
(function(w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({
        'gtm.start': new Date().getTime(),
        event: 'gtm.js'
    });
    var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != 'dataLayer' ? '&l=' + l : '';
    j.async = true;
    j.src =
        '//www.googletagmanager.com/gtm.js?id=' + i + dl;
    f.parentNode.insertBefore(j, f);
})(window, document, 'script', 'dataLayer', 'GTM-5XL76H');
</script>
<a id="top" href="#"><img src="/images/arrow.png"></a>

<footer>
    <div id="footer-content">
        <div id="github">
            <iframe src="http://ghbtns.com/github-btn.html?user=strongloop&amp;repo=express&amp;type=watch&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="110" height="20"></iframe>
        </div>
        <div id="sponsor">El <a href="https://github.com/strongloop/express/">proyecto Express</a> está patrocinado por <a href="http://strongloop.com/">StrongLoop</a>. </div>
        <div id="fork"><a href="https://github.com/strongloop/expressjs.com">Bifurque el sitio web en GitHub</a>.
        </div>
        <div>Copyright &copy; StrongLoop, Inc. y otros colaboradores de expressjs.com.</div>
    </div>
</footer>


  </body>

</html>
